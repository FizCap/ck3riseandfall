##################################################
# Rise and Fall — Puppet Master interactions
# Note: Some tokens here are placeholders pending your scripted effects/triggers; adjust as needed.

# Interaction: Steal Gold
riseandfall_steal_gold_interaction = {
	interface_priority = 100
	common_interaction = yes
	category = interaction_riseandfall
	icon = icon_riseandfall
	show_effects_in_notification = yes
	desc = riseandfall_steal_gold_interaction_desc
	diarch_interaction = yes

	# Show only to the active diarch targeting their liege while a puppet regency is active
	is_shown = {
		# Show to AI actors always, and to human players only when Lite Mode is disabled
		OR = {
			scope:actor = { is_ai = yes }
			AND = {
				scope:actor = { is_ai = no }
				has_game_rule = riseandfall_lite_mode_disabled
			}
		}

		scope:recipient = { has_diarchy_type = puppet_regency }
	}

	# Basic validity (no additional UI failures)
	is_valid_showing_failures_only = {
		riseandfall_liege_stability_below_50 = yes
		scope:recipient = {
			riseandfall_no_cooldown = yes
			riseandfall_liege_has_gold = yes
		}
	}
	is_valid = {
		riseandfall_liege_stability_below_50 = yes
		scope:recipient = {
			riseandfall_no_cooldown = yes
			riseandfall_liege_has_gold = yes
		}
	}

	# Auto-accept: this is a unilateral diarch action
	auto_accept = yes

	# Can send (AI and players)
	can_send = {
		# Ensure we have something to steal — leave precise value check to effect
		always = yes
	}
	# Allow AI to consider this interaction
	ai_potential = { always = yes }
	# Immediate execution (hidden)
	on_accept = {
		custom_tooltip = { text = riseandfall_steal_gold_interaction_desc }
		hidden_effect = {
			riseandfall_steal_gold_effect = yes
			scope:recipient = {
				send_interface_popup = {
					type = send_interface_message_bad
					title = riseandfall_steal_gold_popup_title
					custom_tooltip = riseandfall_steal_gold_popup_desc
					left_icon = scope:actor
				}
				every_vassal = {
					send_interface_message = {
						type = send_interface_message_bad
						title = riseandfall_steal_gold_vassal_notification_title
						custom_tooltip = riseandfall_steal_gold_vassal_notification_desc
						left_icon = scope:actor
					}
				}
			}
		}
	}

	# AI should always consider using it when available
	# How often AI considers this by top-title tier (months)
	ai_frequency = 12

    ai_targets = {
		ai_recipients = liege
		max = 1
	}

	ai_will_do = { base = 100 }
}

# Interaction: Curry Favor (gain a strong favor hook)
riseandfall_curry_favor_interaction = {
	interface_priority = 90
	common_interaction = yes
	category = interaction_riseandfall
	icon = icon_riseandfall
	show_effects_in_notification = yes
	desc = riseandfall_curry_favor_interaction_desc
	diarch_interaction = yes

	is_shown = {
		OR = {
			scope:actor = { is_ai = yes }
			AND = {
				scope:actor = { is_ai = no }
				has_game_rule = riseandfall_lite_mode_disabled
			}
		}

		scope:recipient = { has_diarchy_type = puppet_regency }
	}

	is_valid_showing_failures_only = { 
		scope:recipient = { 
			riseandfall_no_cooldown = yes
			riseandfall_no_existing_hook = yes
		} 
	}
	is_valid = { 
		scope:recipient = { 
			riseandfall_no_cooldown = yes
			riseandfall_no_existing_hook = yes
		} 
	}

	auto_accept = yes

	on_accept = {
		custom_tooltip = { text = riseandfall_curry_favor_interaction_desc }
		hidden_effect = {
			riseandfall_curry_favor_effect = yes
			scope:recipient = {
				send_interface_popup = {
					type = send_interface_message_bad
					title = riseandfall_curry_favor_popup_title
					custom_tooltip = riseandfall_curry_favor_popup_desc
					left_icon = scope:actor
				}
				every_vassal = {
					send_interface_message = {
						type = send_interface_message_bad
						title = riseandfall_curry_favor_vassal_notification_title
						custom_tooltip = riseandfall_curry_favor_vassal_notification_desc
						left_icon = scope:actor
					}
				}
			}
		}
	}
	# How often AI considers this by top-title tier (months)
	ai_frequency = 12
	# Allow AI to consider this interaction
	ai_potential = { always = yes }

    ai_targets = {
		ai_recipients = liege
		max = 1
	}

	ai_will_do = { base = 100 }
}

# Interaction: Overthrow Liege (transfer all titles to diarch)
riseandfall_overthrow_liege_interaction = {
	interface_priority = 80
	common_interaction = no
	category = interaction_riseandfall
	icon = icon_riseandfall
	show_effects_in_notification = yes
	desc = riseandfall_overthrow_liege_interaction_desc
	diarch_interaction = yes

	is_shown = {
		OR = {
			scope:actor = { is_ai = yes }
			AND = {
				scope:actor = { is_ai = no }
				has_game_rule = riseandfall_lite_mode_disabled
			}
		}

		scope:recipient = { has_diarchy_type = puppet_regency }
	}

	# Gate on stability < 30
	is_valid_showing_failures_only = {
		riseandfall_liege_stability_below_30 = yes
		riseandfall_puppet_regency_years_at_least_5 = yes
		riseandfall_no_low_stability_cooldown = yes
	}
	is_valid = {
		riseandfall_liege_stability_below_30 = yes
		riseandfall_puppet_regency_years_at_least_5 = yes
		riseandfall_no_low_stability_cooldown = yes
	}

	auto_accept = yes

	on_accept = {
		custom_tooltip = { text = riseandfall_overthrow_liege_interaction_desc }
		hidden_effect = {
			riseandfall_overthrow_liege_effect = yes
			scope:recipient = {
				send_interface_popup = {
					type = send_interface_message_bad
					title = riseandfall_overthrow_liege_popup_title
					custom_tooltip = riseandfall_overthrow_liege_popup_desc
					left_icon = scope:actor
				}
				every_vassal = {
					send_interface_message = {
						type = send_interface_message_bad
						title = riseandfall_overthrow_liege_vassal_notification_title
						custom_tooltip = riseandfall_overthrow_liege_vassal_notification_desc
						left_icon = scope:actor
					}
				}
			}
		}
	}
	# How often AI considers this by top-title tier (months)
	ai_frequency = 12
	# Allow AI to consider this interaction
	ai_potential = { always = yes }

    ai_targets = {
		ai_recipients = liege
		max = 1
	}

	# Rare/conditional
	ai_will_do = { base = 100 }
}
