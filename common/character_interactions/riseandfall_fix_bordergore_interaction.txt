riseandfall_fix_bordergore_interaction = {
    category = interaction_riseandfall
    auto_accept = yes
    icon = icon_riseandfall
    desc = riseandfall_fix_bordergore_interaction_desc
    target_type = character

    # Only top lieges (king or above) can use this on their vassals
    is_shown = {
        scope:actor = {
            highest_held_title_tier >= tier_kingdom
            is_liege_or_above_of = scope:recipient
            government_has_flag = government_is_administrative
            is_independent_ruler = yes
        }
        scope:recipient = {
            government_has_flag = government_is_administrative
            is_ai = yes
            liege = { this = scope:actor }
            NOT = { is_at_war_with = scope:actor }
        }
    }

    is_valid = {
        scope:actor = {
            highest_held_title_tier >= tier_kingdom
            is_liege_or_above_of = scope:recipient
            government_has_flag = government_is_administrative
        }
        scope:recipient = {
            is_landed = yes
            government_has_flag = government_is_administrative
            NOT = { has_trait = warlord }  # Cannot use on warlords
            NOT = { is_at_war_with = scope:actor }
            liege = { this = scope:actor }
            NOT = { highest_held_title_tier = tier_county }  # Counts are not eligible for bordergore fix
            # Save recipient's capital county's de jure kingdom
            capital_province = {
                county = {
                    de_jure_liege = {
                        de_jure_liege = {
                            save_scope_as = recipient_capital_dejure_kingdom
                        }
                    }
                }
            }
            OR = {
                # Directly held counties by recipient that would be transferred
                custom_tooltip = {
                    text = riseandfall_fix_bordergore.recipient_direct_counties.tooltip
                    subject = scope:recipient
                    any_held_title = {
                        tier = tier_county
                        exists = de_jure_liege
                        holder = scope:recipient
                        NOT = { holder = scope:liege }
                        NOT = { holder = { is_ai = no } }
                        NOT = { scope:recipient = { highest_held_title_tier = tier_county } }  # Do not transfer direct counties from counts
                            AND = {
                                # Fast, reliable check: county's de jure kingdom is NOT the recipient's capital de jure kingdom
                                NOT = { de_jure_liege = { de_jure_liege = { this = scope:recipient_capital_dejure_kingdom } } }
                            }
                    }
                }
                # Subrealm counties (held by direct vassals) that would be transferred
                custom_tooltip = {
                    text = riseandfall_fix_bordergore.vassal_direct_counties.tooltip
                    subject = scope:recipient
                    any_vassal = {
                        any_held_title = {
                            tier = tier_county
                            exists = de_jure_liege
                            NOT = { holder = scope:liege }
                            NOT = { holder = { is_ai = no } }
                            NOT = { holder = scope:recipient }
                            NOT = { this = scope:liege.capital_province.county }
                            NOT = { this = scope:recipient.capital_province.county }
                                AND = {
                                    # Treat a vassal-held county as bordergore candidate when its de jure kingdom
                                    # does not match the recipient's capital de jure kingdom.
                                    NOT = { de_jure_liege = { de_jure_liege = { this = scope:recipient_capital_dejure_kingdom } } }
                                }
                            NOT = { AND = { has_variable = Riseandfall_giveaway_blocked scope:liege = { is_ai = no } } }
                        }
                    }
                }
            }
        }
    }

    on_accept = {
        # Run the scripted effect under the actor scope; effect will reference scope:recipient
        scope:actor = {
            riseandfall_fix_bordergore_se = yes
        }
    }

    ai_frequency = 1

    # Allow the AI to consider this interaction when populating potential actions
    ai_potential = { always = yes }

    ai_targets = {
        # Which characters does the ai consider as recipient for the interaction
        # Use a built-in target list; 'vassals' will make the AI consider vassals of the actor
        ai_recipients = vassals
        max = 100
    }

    ai_will_do = { base = 100 }
}