riseandfall_fix_bordergore_interaction = {
    category = interaction_category_diarch
    auto_accept = yes
    desc = riseandfall_fix_bordergore_interaction_desc
    target_type = character

    # Only top lieges (king or above) can use this on their vassals
    is_shown = {
        scope:actor = {
            highest_held_title_tier >= tier_kingdom
            is_liege_or_above_of = scope:recipient
            government_has_flag = government_is_administrative
            is_independent_ruler = yes
        }
        scope:recipient = {
            government_has_flag = government_is_administrative
            liege = { this = scope:actor }
            NOT = { is_at_war_with = scope:actor }
            # Visibility gate: recipient OR their direct vassals hold a county whose immediate de jure duchy is NOT held by recipient
            OR = {
                any_held_title = {
                    tier = tier_county
                    NOT = { de_jure_liege = { holder = scope:recipient } }
                    # Exclude counties whose holder is already a direct vassal of the actor (liege); actor can act directly
                    NOT = { holder = { liege = { this = scope:actor } } }
                }
                any_vassal = {
                    any_held_title = {
                        tier = tier_county
                        NOT = { de_jure_liege = { holder = scope:recipient } }
                        NOT = { holder = { liege = { this = scope:actor } } }
                    }
                }
            }
        }
    }

    is_valid = {
        scope:actor = {
            highest_held_title_tier >= tier_kingdom
            is_liege_or_above_of = scope:recipient
            government_has_flag = government_is_administrative
        }
        scope:recipient = {
            is_landed = yes
            government_has_flag = government_is_administrative
            NOT = { has_trait = warlord }  # Cannot use on warlords
            NOT = { is_at_war_with = scope:actor }
            liege = { this = scope:actor }
            # Validity gate: stray county directly held OR by a direct vassal beyond full de jure chain (up to empire)
            OR = {
                any_held_title = {
                    tier = tier_county
                    NOT = { de_jure_liege = { holder = scope:recipient } }
                    NOT = { de_jure_liege = { de_jure_liege = { holder = scope:recipient } } }
                    NOT = { de_jure_liege = { de_jure_liege = { de_jure_liege = { holder = scope:recipient } } } }
                    NOT = { de_jure_liege = { de_jure_liege = { de_jure_liege = { de_jure_liege = { holder = scope:recipient } } } } }
                    NOT = { holder = { liege = { this = scope:actor } } }
                }
                any_vassal = {
                    any_held_title = {
                        tier = tier_county
                        NOT = { de_jure_liege = { holder = scope:recipient } }
                        NOT = { de_jure_liege = { de_jure_liege = { holder = scope:recipient } } }
                        NOT = { de_jure_liege = { de_jure_liege = { de_jure_liege = { holder = scope:recipient } } } }
                        NOT = { de_jure_liege = { de_jure_liege = { de_jure_liege = { de_jure_liege = { holder = scope:recipient } } } } }
                        NOT = { holder = { liege = { this = scope:actor } } }
                    }
                }
            }
        }
    }

    on_accept = {
        # Run the scripted effect under the actor scope; effect will reference scope:recipient
        scope:actor = {
            riseandfall_fix_bordergore_se = yes
        }
    }

    ai_frequency = 1

    # Allow the AI to consider this interaction when populating potential actions
    ai_potential = { always = yes }

    ai_targets = {
        # Which characters does the ai consider as recipient for the interaction
        # Use a built-in target list; 'vassals' will make the AI consider vassals of the actor
        ai_recipients = vassals
        max = 99
    }

    ai_will_do = { base = 100 }
}
