###############################
# Rise and Fall: Siege effects
###############################

# Scripted effect called by on_siege_looting. Expects the following saved scopes:
# - scope:rf_looted_county (province owner county)
# - scope:rf_looted_barony (the specific barony looted)
# - scope:rf_sieger (root, the sieging character)

riseandfall_on_siege_looting_se = {
    # If the sieger is a newly-created adventurer, spawn a respawn army
    scope:rf_sieger = {
        if = {
            limit = { has_character_flag = riseandfall_newadventurer }
            # Spawn the army at the looted barony's province if available.
            # Use the adventurer's saved variable `adventurer_respawn_army_size` directly if present.
            if = {
                limit = { exists = scope:rf_looted_barony }
                if = {
                    limit = { scope:rf_sieger = { has_variable = adventurer_respawn_army_size } }
                    spawn_army = {
                        name = riseandfall_adventurer_respawn_army_name
                        levies = scope:rf_sieger.var:adventurer_respawn_army_size
                        location = scope:rf_looted_barony.title_province
                        uses_supply = no
                    }
                }
            }
        }
    }
}
