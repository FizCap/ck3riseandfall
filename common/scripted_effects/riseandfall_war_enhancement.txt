# Scripted effects for Rise and Fall war enhancement events

# Event .1 immediate: Imprison family members related to the killer
war_enhancement_imprison_family = {
	scope:riseandfall_war_enhancement_prev_liege = {
		every_close_or_extended_family_member = {
			limit = {
				is_independent_ruler = no
				root = {
					any_close_family_member = {
						even_if_dead = yes
						exists = killer
						killer = prev
					}
				}
			}
			save_temporary_scope_as = riseandfall_war_enhancement_tbi
			root = {
				imprison = { target = scope:riseandfall_war_enhancement_tbi }
			}
		}
	}
}

# Event .1.a effect: Press claims
war_enhancement_press_claims = {
	root = {
		create_title_and_vassal_change = {
			type = faction_demand
			save_scope_as = change
		}		
	}
	
	scope:riseandfall_war_enhancement_liege_primary_title.holder = {
		every_held_title = { 
			limit = { 
				OR = {
					AND = {
						previous_holder = scope:riseandfall_war_enhancement_prev_liege
						title_held_years < 1
					}
					AND = {
						has_claim = root
						de_jure_liege = scope:riseandfall_war_enhancement_liege_primary_title
					}
				}
			}
			change_title_holder_include_vassals = {
				holder = root
				change = scope:change
			}
		}
	}
	
	root = {
		resolve_title_and_vassal_change = scope:change
	}
}

# Event .1.b effect: Elect ruler (not liege)
war_enhancement_elect_ruler_not_liege = {
	scope:riseandfall_war_enhancement_attacker.liege.primary_title.holder = { 
		try_start_diarchy = regency
		set_diarch = root
		change_diarchy_swing = 100
	}
	
	scope:riseandfall_war_enhancement_attacker.liege.primary_title = {
		add_title_law = feudal_elective_succession_law
	}
	
	scope:riseandfall_war_enhancement_attacker.liege.diarch = {
		trigger_event = {
			id = riseandfall_war_enhancement.6
			days = 30
		}
	}
}

# Event .1.c effect: Elect ruler (still liege)
war_enhancement_elect_ruler_still_liege = {
	scope:riseandfall_war_enhancement_liege_primary_title.holder = { 
		try_start_diarchy = regency
		set_diarch = root
		change_diarchy_swing = 100
	}
	
	scope:riseandfall_war_enhancement_liege_primary_title = {
		add_title_law = feudal_elective_succession_law
	}
	
	scope:riseandfall_war_enhancement_liege_primary_title.holder.diarch = {
		trigger_event = {
			id = riseandfall_war_enhancement.6
			days = 30
		}
	}
}

# Event .1.d effect: Independence
war_enhancement_declare_independence = {
	create_title_and_vassal_change = {
		type = independency 
		save_scope_as = change
	}
	becomes_independent = {
		change = scope:change
	}
	resolve_title_and_vassal_change = scope:change
}

# Event .2.a effect: Execute previous liege
war_enhancement_execute_liege = {
	scope:riseandfall_war_enhancement_prev_liege = {
		death = {
			death_reason = death_execution
			killer = root
		}
	}
	if = {
		limit = { 
			scope:riseandfall_war_enhancement_attacker = { has_government = feudal_government }
		}
		scope:riseandfall_war_enhancement_attacker = {
			trigger_event = {
				id = riseandfall_war_enhancement.1
			}
		}		
	}
}

# Event .2.d1 effect: Imprison previous liege
war_enhancement_imprison_liege = {
	root = { imprison = { target = scope:riseandfall_war_enhancement_prev_liege } }
	if = {
		limit = { 
			scope:riseandfall_war_enhancement_attacker = { has_government = feudal_government }
		}
		scope:riseandfall_war_enhancement_attacker = {
			trigger_event = {
				id = riseandfall_war_enhancement.1
			}
		}		
	}
}

# Event .3.a effect: Start war against liege
war_enhancement_start_war_against_liege = {
	start_war = {
		casus_belli = refused_liege_demand_war
		target = root.liege
	}
}

# Event .4.a effect: Join civil war
war_enhancement_join_civil_war = {
	scope:riseandfall_war_enhancement_highest_title_man = {
		random_character_war = {
			limit = {
				is_civil_war = yes
			}
			add_attacker = root
		}
	}
}

# Event .6.a effect: Abdicate to heir
war_enhancement_abdicate_to_heir = {
	root = {
		create_title_and_vassal_change = {
			type = faction_demand
			save_scope_as = change
		}		
	}
	scope:riseandfall_war_enhancement_attacker.liege.primary_title = {
		change_title_holder_include_vassals = {
			holder = scope:riseandfall_war_enhancement_attacker.liege.primary_title.current_heir
			change = scope:change
		}
	}
	scope:riseandfall_war_enhancement_attacker.liege = {
		every_held_title = { 
			limit = {
				AND = {
					OR = {
						holder = scope:riseandfall_war_enhancement_attacker.liege
						previous_holder = scope:riseandfall_war_enhancement_prev_liege
					}
					title_held_years < 1
					OR = {
						has_claim = riseandfall_war_enhancement_attacker.liege.primary_title.current_heir
						de_jure_liege = scope:riseandfall_war_enhancement_attacker.liege.primary_title
						de_facto_liege = scope:riseandfall_war_enhancement_attacker.liege.primary_title
					}
				}
			}
			change_title_holder_include_vassals = {
				holder = scope:riseandfall_war_enhancement_attacker.liege.primary_title.current_heir
				change = scope:change
			}
		}
	}
	
	scope:riseandfall_war_enhancement_attacker.liege = {
		change_liege = {
			liege = scope:riseandfall_war_enhancement_attacker.liege.primary_title.current_heir
			change = scope:change
		}
	}
			
	root = {
		resolve_title_and_vassal_change = scope:change
	}
	scope:riseandfall_war_enhancement_liege_primary_title = { remove_title_law = feudal_elective_succession_law }
}

# Event .6.b effect: Extend rule temporarily
war_enhancement_extend_rule = {
	root = {
		add_tyranny = 10
		trigger_event = {
			id = riseandfall_war_enhancement.6
			days = 60
		}
	}
}

# Event .6.c effect: Seize power tyrannically
war_enhancement_seize_power = {
	add_tyranny = 25
	root = {
		create_title_and_vassal_change = {
			type = usurped
			save_scope_as = change
		}		
	}
	scope:riseandfall_war_enhancement_attacker.liege.primary_title = {
		change_title_holder_include_vassals = {
			holder = root
			change = scope:change
		}
	}
	scope:riseandfall_war_enhancement_attacker.liege = {
		every_held_title = { 
			limit = { 
				OR = {
					AND = {
						previous_holder = scope:riseandfall_war_enhancement_prev_liege
						title_held_years < 1
						OR = {
							has_claim = root
							de_jure_liege = scope:riseandfall_war_enhancement_attacker.liege.primary_title
							de_facto_liege = scope:riseandfall_war_enhancement_attacker.liege
						}
					}
					this = title_capital_county
				}
			}
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
	}
	root = {
		resolve_title_and_vassal_change = scope:change
	}
	scope:riseandfall_war_enhancement_liege_primary_title = { remove_title_law = feudal_elective_succession_law }
}
