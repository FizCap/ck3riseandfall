namespace = warlord

# Liege-facing notification: informs the ruler that warlords are rising among vassals
warlord.1001 = {
    type = character_event
    title = warlord.1001.t
    desc = warlord.1001.d
    theme = realm

    left_portrait = root

    option = {
        name = warlord.1001.a
        ai_chance = { base = 100 }
        # Grant the liege a realm law and run the hidden_effect so the iteration runs in effect scope
        if = {
            limit = { NOT = { has_realm_law = crown_authority_0 } }
            add_realm_law = crown_authority_0
        }
        hidden_effect = {
            riseandfall_warlord_notify_vassals = yes
            # Set low stability cooldown on the liege when this event fires
            set_variable = { name = low_stability_cooldown value = yes years = 5 }
        }
    }
}

# Vassal-facing decision: vassals may choose to become a warlord or remain loyal
warlord.1002 = {
    type = character_event
    title = warlord.1002.t
    desc = warlord.1002.d
    theme = realm

    left_portrait = liege
    right_portrait = root

    immediate = {
        # Present a choice; effects happen in options below
    }

    option = {
        name = warlord.1002.a
        # Become a warlord: gain the 'warlord' trait and create a decision to raise faction/claim
        riseandfall_warlord_become_warlord = yes
        ai_chance = {
            base = 0
            modifier = {
                add = 100
                is_independent_ruler = no
                opinion = { target = liege value < 50 }
            }
        }
    }

    option = {
        name = warlord.1002.b
        # Remain loyal: boost relationzs with liege instead of adding trait
        riseandfall_warlord_remain_loyal = yes
        # small positive opinion or stability bonus could be added by scripted effects
        ai_chance = {
            base = 0
            modifier = {
                add = 100
                is_independent_ruler = yes
            }
            modifier = {
                add = 100
                is_independent_ruler = no
                opinion = { target = liege value >= 50 }
            }
        }
    }
}

# Warlord event: triggered for rulers with the warlord trait
warlord.1003 = {
    type = character_event
    title = warlord.1003.t
    desc = warlord.1003.d
    theme = realm

    left_portrait = liege
    right_portrait = root

    option = {
        name = warlord.1003.a
        ai_chance = {
            base = 0
            modifier = {
                add = 100
                NOT = { is_independent_ruler = yes }
            }
        }
        # Give claims on the liege's own titles to the warlord (only for powerful vassals)
        riseandfall_warlord_claim_liege_titles = yes
    }
    option = {
        name = warlord.1003.b
        # Remove the warlord trait and abandon the path if opinion >= 50
        ai_chance = {
            base = 0
            modifier = {
                add = 100
                is_independent_ruler = yes
            }
            modifier = {
                add = 100
                opinion = { target = liege value >= 50 }
            }
        }
        if = {
            limit = { opinion = { target = liege value >= 50 } }
            riseandfall_warlord_abandon_path = yes
        }
    }
}
