namespace = palace_coup

palace_coup.1001 = {
	type = character_event
	title = palace_coup.1001.t
	desc = palace_coup.1001.desc
	theme = court

	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:challenger
	}

	immediate = {
		riseandfall_palace_coup_setup = yes
	}

	# Option to confront the challenger
	option = {
		name = palace_coup.1001.a
		custom_tooltip = palace_coup.1001.tooltip
		trigger = { exists = scope:challenger }
		# Trigger the choice event
		trigger_event = { id = palace_coup.1002 }
		ai_chance = { base = 100 }
	}

}

palace_coup.1002 = {
	type = character_event
	title = palace_coup.1002.t
	desc = palace_coup.1002.d
	theme = court

	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:challenger
	}

	option = {
		name = palace_coup.1002.a
		custom_tooltip = palace_coup.1002.tooltip
		trigger = { exists = scope:challenger }

		duel = {
			skill = prowess
			target = scope:challenger

			# Root wins duel
			5 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = -20
				}

				custom_tooltip = palace_coup.1002.win.tooltip

				# Root wins duel: do not transfer the challenger's gold; just kill the challenger

				hidden_effect = {
					riseandfall_palace_coup_root_wins_prowess_duel = yes
				}
			}

			# Challenger wins duel
			95 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -20
				}

				custom_tooltip = palace_coup.1002.lose.tooltip

				hidden_effect = {
					riseandfall_palace_coup_challenger_wins_prowess_duel = yes
				}
			}
		}

		ai_chance = {
			base = 0
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 1 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 2 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 3 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 4 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 5 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 6 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 7 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 8 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 9 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 10 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 11 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 12 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 13 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 14 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 15 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 16 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 17 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 18 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 19 }
			}
			modifier = {
				add = 5
				prowess_diff = { target = scope:challenger value >= 20 }
			}
		}
	}

	option = {
		name = palace_coup.1002.b
		trigger = { exists = scope:challenger }

		duel = {
			skill = intrigue
			target = scope:challenger

			# Success: root escapes
			60 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}

				custom_tooltip = palace_coup.1002.flee_success.tooltip

				hidden_effect = {
					riseandfall_palace_coup_root_flees_success = yes
				}
			}			# Failure: challenger captures/seizes the ruler
			40 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}

				custom_tooltip = palace_coup.1002.fail.tooltip

				hidden_effect = {
					riseandfall_palace_coup_root_flees_failure = yes
				}
			}
		}

		ai_chance = {
			base = 100
			modifier = {
				add = 10
				NOT = { intrigue_diff = { target = scope:challenger value <= 0 } }
			}
			modifier = {
				add = -10
				intrigue_diff = { target = scope:challenger value <= -1 }
			}
			modifier = {
				add = 100
				prowess_diff = { target = scope:challenger value <= -1 }
			}
		}
	}
}

palace_coup.1003 = {
	type = character_event
	title = palace_coup.1003.t
	desc = palace_coup.1003.d
	theme = court

    left_portrait = {
		character = root
	}

	option = {
		name = palace_coup.1003.a
		custom_tooltip = palace_coup.1003.tooltip
		# Call the banners / raise the vassal levy
		# Trigger the warlord path for the challenger (raise banners handled there)
		riseandfall_palace_coup_challenger_calls_banners = yes
		ai_chance = { base = 100 }
	}
}

palace_coup.1004 = {
	type = character_event
	title = palace_coup.1004.t
	desc = palace_coup.1004.d
	theme = court

	left_portrait = { character = root }
	right_portrait = { character = scope:challenger }

	option = {
		name = palace_coup.1004.a
		custom_tooltip = palace_coup.1004.tooltip
		hidden_effect = {
			riseandfall_palace_coup_root_death = yes
		}
		ai_chance = { base = 100 }
	}

}
